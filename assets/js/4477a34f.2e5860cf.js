"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[615],{8453:(e,n,r)=>{r.d(n,{R:()=>l,x:()=>i});var s=r(6540);const o={},t=s.createContext(o);function l(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:l(e.components),s.createElement(t.Provider,{value:n},e.children)}},8866:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>h,frontMatter:()=>l,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"Logs/Collecting Logs","title":"Collecting Logs","description":"Overview","source":"@site/docs/Logs/Collecting Logs.md","sourceDirName":"Logs","slug":"/Logs/Collecting Logs","permalink":"/Fluentd/docs/Logs/Collecting Logs","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Logs/Collecting Logs.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar"}');var o=r(4848),t=r(8453);const l={},i="Collecting Logs",c={},d=[{value:"Overview",id:"overview",level:2},{value:"Requirements",id:"requirements",level:2},{value:"Tail plugin",id:"tail-plugin",level:3},{value:"Eample Configuration",id:"eample-configuration",level:3},{value:"How It Works",id:"how-it-works",level:3},{value:"Reading JSON, Apache, Syslog Logs",id:"reading-json-apache-syslog-logs",level:3},{value:"How to Run with Docker",id:"how-to-run-with-docker",level:3},{value:"Project Structure:",id:"project-structure",level:4},{value:"Docker Run Command:",id:"docker-run-command",level:4},{value:"Log Samples",id:"log-samples",level:3},{value:"JSON Log (<code>json.log</code>):",id:"json-log-jsonlog",level:4},{value:"Apache Log (<code>apache.log</code>):",id:"apache-log-apachelog",level:4},{value:"Syslog Log (<code>syslog.log</code>):",id:"syslog-log-sysloglog",level:4}];function a(e){const n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"collecting-logs",children:"Collecting Logs"})}),"\n",(0,o.jsx)(n.admonition,{title:"if you want to collect and route logs - use Fluentd agent",type:"note"}),"\n",(0,o.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,o.jsxs)(n.p,{children:["Fluentd is a fully free and fully open-source log collector that instantly enables you to have a Log Everything' architecture with ",(0,o.jsx)(n.a,{href:"https://www.fluentd.org/plugins",children:"125+ types of systems."})]}),"\n",(0,o.jsxs)(n.p,{children:["You can visit ",(0,o.jsx)(n.a,{href:"https://www.fluentd.org/",children:"official site"})]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{alt:"alt text",src:r(9714).A+"",width:"892",height:"560"})}),"\n",(0,o.jsx)(n.p,{children:"Fluentd treats logs as JSON, a popular machine-readable format. It is written primarily in C with a thin-Ruby wrapper that gives users flexibility."}),"\n",(0,o.jsx)(n.h2,{id:"requirements",children:"Requirements"}),"\n",(0,o.jsx)(n.p,{children:"To successfully install and run Fluentd on your system, the following software and hardware requirements must be met:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"CPU and RAM"}),"\r\nMinimum: 1 vCPU, 512MB RAM\r\nRecommended: 2+ vCPUs, 2GB+ RAM (for handling large log volumes)"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Disk Space"}),"\r\nAt least 1GB of free disk space (for logs and buffer files)\r\nSSD is recommended for faster disk I/O performance"]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"To use the td-agent (Fluentd\u2019s stable production version), you can install it using the official installation script:"}),"\n",(0,o.jsx)(n.p,{children:"Step-by-step:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"curl -fsSL https://toolbelt.treasuredata.com/sh/install-ubuntu-focal-td-agent4.sh | sh\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Replace ",(0,o.jsx)(n.code,{children:"ubuntu-focal"})," with your OS version (e.g., ",(0,o.jsx)(n.code,{children:"centos7"}),", ",(0,o.jsx)(n.code,{children:"debian-buster"}),", etc.)"]}),"\n",(0,o.jsx)(n.p,{children:"After installation is complete, you can verify it with:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"td-agent --version\n"})}),"\n",(0,o.jsx)(n.h3,{id:"tail-plugin",children:"Tail plugin"}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"in_tail"})," Input plugin allows Fluentd to read events from the tail of text files. Its behavior is similar to the ",(0,o.jsx)(n.code,{children:"tail -F"})," command. Each log is collected throughout ",(0,o.jsx)(n.code,{children:"<source> </source>"})]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"eample-configuration",children:"Eample Configuration"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"<source>\r\n  @type tail\r\n  path /var/log/json.log\r\n  pos_file /fluentd/logs/json.pos\r\n  tag json.log\r\n  <parse>\r\n    @type json\r\n  </parse>\r\n</source>\n"})}),"\n",(0,o.jsx)(n.h3,{id:"how-it-works",children:"How It Works"}),"\n",(0,o.jsxs)(n.p,{children:["When Fluentd is first configured with ",(0,o.jsx)(n.code,{children:"in_tail"}),", it will start reading from the ",(0,o.jsx)(n.em,{children:(0,o.jsx)(n.strong,{children:"tail"})})," of that log, not the beginning. Once the log is rotated, Fluentd starts reading the new file from the beginning. It keeps track of the current inode number."]}),"\n",(0,o.jsxs)(n.p,{children:["If ",(0,o.jsx)(n.code,{children:"td-agent"})," restarts, it resumes reading from the last position before the restart. This position is recorded in the position file specified by the ",(0,o.jsx)(n.code,{children:"pos_file "}),"parameter."]}),"\n",(0,o.jsx)(n.h3,{id:"reading-json-apache-syslog-logs",children:"Reading JSON, Apache, Syslog Logs"}),"\n",(0,o.jsx)(n.p,{children:"To read logs from Json, Apache, Syslog etc. You need to follow below steps. In addition to this, these step will be similir to other sources. Once you learn these steps other steps will be easier."}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:"JSON / Apche / Syslog Logs Source:"}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:'\r\n<source>\r\n  @type tail \r\n  path /var/log/json.log\r\n  pos_file /fluentd/logs/json.pos\r\n  tag json.log\r\n  <parse>\r\n    @type json\r\n  </parse>\r\n</source>\r\n\r\n<source>\r\n  @type tail\r\n  path /var/log/apache.log\r\n  pos_file /fluentd/logs/apache.pos\r\n  tag apache.log\r\n  <parse>\r\n    @type apache2\r\n  </parse>\r\n</source>\r\n\r\n<source>\r\n  @type tail\r\n  path /var/log/syslog.log\r\n  pos_file /fluentd/logs/syslog.pos\r\n  tag syslog.log\r\n  <parse>\r\n    @type syslog\r\n  </parse>\r\n</source>\r\n\r\n<filter json.log>\r\n  @type record_transformer\r\n  enable_ruby true\r\n  <record>\r\n    Timestamp ${Time.at(time.to_i).utc.strftime(\'%Y-%m-%dT%H:%M:%SZ\')}\r\n    Level ${record["level"] || "Info"}\r\n    Message ${record["message"]}\r\n    Source ${record["source"]}\r\n    SourceIp "#{Socket.ip_address_list.detect(&:ipv4_private?)&.ip_address}"\r\n    LogPath /var/log/json\r\n    tag json_logs\r\n  </record>\r\n</filter>\r\n\r\n<filter apache.log>\r\n  @type record_transformer \r\n  enable_ruby true\r\n  <record>\r\n    Timestamp ${Time.at(time.to_i).utc.strftime(\'%Y-%m-%dT%H:%M:%SZ\')}\r\n    Level ${record["level"] || "Info"}\r\n    Message ${record["message"]}\r\n    Source ${record["source"]}\r\n    SourceIp "#{Socket.ip_address_list.detect(&:ipv4_private?)&.ip_address}"\r\n    LogPath /var/log/apache\r\n    tag apache_logs\r\n  </record>\r\n</filter>\r\n\r\n<filter syslog.log>\r\n  @type record_transformer\r\n  enable_ruby true\r\n  <record>\r\n    Timestamp ${Time.at(time.to_i).utc.strftime(\'%Y-%m-%dT%H:%M:%SZ\')}\r\n    Level ${record["level"] || "Info"}\r\n    Message ${record["message"]}\r\n    Source ${record["source"]}\r\n    SourceIp "#{Socket.ip_address_list.detect(&:ipv4_private?)&.ip_address}"\r\n    LogPath /var/log/syslog\r\n    tag syslog_logs\r\n  </record>\r\n</filter>\r\n\r\n<match *.log>\r\n  @type stdout\r\n</match>\n'})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"@type"})," tail Reads log entries from a file."]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"path"})," Location of the ",(0,o.jsx)(n.code,{children:"json.log"})," file."]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"pos_file"})," Stores the position of the last read line to ensure Fluentd picks up from the same place after restart."]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"tag"})," Used to route events in the pipeline."]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"parse"})," in Fluentd is used to convert raw log lines into structured data using predefined or custom formats like ",(0,o.jsx)(n.code,{children:"json"}),", ",(0,o.jsx)(n.code,{children:"regexp"}),", or ",(0,o.jsx)(n.code,{children:"apache2"}),"."]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"enable_rubly"})," allows you to write Ruby code inside ",(0,o.jsx)(n.code,{children:"<record>"})," blocks. When set to ",(0,o.jsx)(n.code,{children:"true"}),", Ruby expressions like ",(0,o.jsx)(n.code,{children:"#{}"})," are evaluated. ",(0,o.jsx)(n.code,{children:"<record> <record>"})," block is used to ",(0,o.jsx)(n.strong,{children:"add custom fields"})," to each log event. These fields are ",(0,o.jsx)(n.strong,{children:"appended"})," to the output of the log pipeline (e.g., to file, stdout, Elasticsearch, etc.)."]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"Timestamp"})," Converts Fluentd's event time to ISO 8601 UTC format."]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"Level"})," Defaults to ",(0,o.jsx)(n.code,{children:'"Inf"o"'}),"if not specified in the log."]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"Message"}),", ",(0,o.jsx)(n.code,{children:"Source"})," Extracted directly from the log record."]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"SourceIp"})," Dynamically detects and embeds the host's internal IP address."]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"LogPath"})," Hardcoded to identify the source directory."]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"tag"})," Provides a secondary tag for downstream identification (not used for routing here). The same structure is applied to Apache and Syslog filters with minor differences in ",(0,o.jsx)(n.code,{children:"LogPath"})," and tag."]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"<match> "})," Captures all events with a tag ending in ",(0,o.jsx)(n.code,{children:".log"}),"."]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"stdout"})," Outputs the final log record to the standard output, useful for debugging or Docker logging."]}),"\n",(0,o.jsx)(n.h3,{id:"how-to-run-with-docker",children:"How to Run with Docker"}),"\n",(0,o.jsx)(n.p,{children:"You can run this Fluentd configuration in a Docker container using the following steps:"}),"\n",(0,o.jsx)(n.h4,{id:"project-structure",children:"Project Structure:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"Fluentd_Task/\r\n\u251c\u2500\u2500 fluent.conf\r\n\u251c\u2500\u2500 logs/\r\n\u2502   \u251c\u2500\u2500 json.log\r\n\u2502   \u251c\u2500\u2500 apache.log\r\n\u2502   \u2514\u2500\u2500 syslog.log\n"})}),"\n",(0,o.jsx)(n.h4,{id:"docker-run-command",children:"Docker Run Command:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:'docker run -d \\\r\n  --name fluentd-log-aggregator \\\r\n  -v "$(pwd)/fluent.conf:/fluentd/etc/fluent.conf" \\\r\n  -v "$(pwd)/logs:/var/log" \\\r\n  -p 9880:9880 \\\r\n  fluent/fluentd:v1.16-\n'})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"-v"})," mounts the local configuration and logs directory into the container."]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Logs written to ",(0,o.jsx)(n.code,{children:"logs/"})," will be tailed by Fluentd in real-time."]}),"\n",(0,o.jsxs)(n.li,{children:["Use ",(0,o.jsx)(n.code,{children:"docker logs -f fluentd-log-aggregator"})," to monitor the Fluentd output."]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"log-samples",children:"Log Samples"}),"\n",(0,o.jsxs)(n.h4,{id:"json-log-jsonlog",children:["JSON Log (",(0,o.jsx)(n.code,{children:"json.log"}),"):"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:'{"level": "warn", "message": "User login failed", "source": "auth-service"}\n'})}),"\n",(0,o.jsxs)(n.h4,{id:"apache-log-apachelog",children:["Apache Log (",(0,o.jsx)(n.code,{children:"apache.log"}),"):"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:'127.0.0.1 - - [10/Jul/2025:09:00:00 +0000] "GET /index.html HTTP/1.1" 200 612\n'})}),"\n",(0,o.jsxs)(n.h4,{id:"syslog-log-sysloglog",children:["Syslog Log (",(0,o.jsx)(n.code,{children:"syslog.log"}),"):"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"<34>Jul 10 09:02:30 server-name sshd[1234]: Failed password for invalid user\n"})}),"\n",(0,o.jsxs)(n.p,{children:["These logs will be parsed and transformed into structured events with unified fields like ",(0,o.jsx)(n.code,{children:"Timestamp"}),", ",(0,o.jsx)(n.code,{children:"Message"}),", ",(0,o.jsx)(n.code,{children:"Level"}),", etc."]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(a,{...e})}):a(e)}},9714:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/fluentd-architecture-47b81be98e829cf44720ddcaab7a477e.png"}}]);